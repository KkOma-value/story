# 账号密码登录系统测试场景

## 测试环境配置

### 方式1：使用Mock数据（推荐）
```bash
cd frontend
echo "VITE_API_MODE=mock" > .env.development
npm run dev
```

### 方式2：使用真实后端
```bash
# 启动后端
cd backend
.\venw\Scripts\Activate.ps1  # Windows
python manage.py runserver 0.0.0.0:8000

# 启动前端（另一个终端）
cd frontend
echo "VITE_API_MODE=real" > .env.development
npm run dev
```

## 测试账号

### Mock模式测试账号
- **管理员账号**：admin / admin123
- **普通用户账号**：test@example.com / test123
- **任意账号**：输入6位以上密码（如123456）即可登录

### 真实后端测试账号
- **管理员账号**：admin / admin123（需在后端数据库中创建）
- **注册新账号**：使用邮箱验证码注册流程

## 核心功能测试场景

### 1. 注册流程测试

#### 测试步骤：
1. 访问注册页面：`http://localhost:5173/register`
2. 输入账号名：testuser
3. 输入显示名：测试用户
4. 输入邮箱：test@example.com
5. 输入密码：test123
6. 确认密码：test123
7. 点击"发送验证码"
8. 查看验证码：
   - Mock模式：验证码固定为 `123456`
   - 真实后端：查看后端控制台输出
9. 输入验证码
10. 点击"立即注册"

#### 预期结果：
- ✅ 验证码发送成功提示
- ✅ 注册成功提示
- ✅ 自动跳转到登录页面

#### 验证点：
- [x] 表单验证工作正常（必填字段、密码一致性）
- [x] 验证码倒计时功能正常
- [x] 注册成功后跳转正确
- [x] 错误提示清晰（邮箱已存在、验证码错误等）

---

### 2. 账号名登录测试

#### 测试步骤：
1. 访问登录页面：`http://localhost:5173/login`
2. 输入账号名：testuser（或admin）
3. 输入密码：test123（或admin123）
4. 点击"登录"

#### 预期结果：
- ✅ 登录成功
- ✅ Token存储在localStorage
- ✅ 跳转到首页
- ✅ 显示用户头像和用户名

#### 验证点：
- [x] 账号名和邮箱都能作为登录凭证
- [x] 密码错误提示正确
- [x] Token正确存储和读取
- [x] 用户信息正确显示

---

### 3. 邮箱登录测试

#### 测试步骤：
1. 退出登录
2. 访问登录页面：`http://localhost:5173/login`
3. 输入邮箱：test@example.com（或admin@test.com）
4. 输入密码：test123（或admin123）
5. 点击"登录"

#### 预期结果：
- ✅ 登录成功
- ✅ 与账号名登录行为一致

#### 验证点：
- [x] 邮箱格式验证正确
- [x] 登录成功后的跳转正确
- [x] 用户状态管理正常

---

### 4. 密码重置流程测试

#### 测试步骤：
1. 退出登录
2. 访问登录页面：`http://localhost:5173/login`
3. 点击"忘记密码？"
4. 输入注册邮箱：test@example.com
5. 点击"发送验证码"
6. 查看验证码：
   - Mock模式：验证码固定为 `123456`
   - 真实后端：查看后端控制台输出
7. 输入验证码
8. 输入新密码：newpassword123
9. 确认新密码：newpassword123
10. 点击"重置密码"

#### 预期结果：
- ✅ 验证码发送成功
- ✅ 进入第二步表单
- ✅ 密码重置成功
- ✅ 自动跳转到登录页面

#### 验证点：
- [x] 步骤指示器显示正确
- [x] 验证码倒计时功能正常
- [x] 新密码和确认密码验证一致
- [x] 重置成功后跳转正确
- [x] 使用新密码可以登录

---

### 5. 错误处理测试

#### 5.1 账号不存在
1. 登录时输入不存在的账号名或邮箱
2. 输入任意密码
3. 预期：提示"用户不存在"

#### 5.2 密码错误
1. 输入正确的账号名或邮箱
2. 输入错误的密码
3. 预期：提示"账号/邮箱或密码错误"

#### 5.3 邮箱未注册
1. 在忘记密码页面输入未注册的邮箱
2. 预期：提示"邮箱不存在"（真实后端）或发送成功（mock）

#### 5.4 验证码错误
1. 在注册或重置密码时输入错误的验证码
2. 预期：提示"验证码错误"

#### 5.5 表单验证错误
- 空的必填字段
- 无效的邮箱格式
- 密码长度不足（<6位）
- 密码和确认密码不一致
- 预期：相应的验证错误提示

---

### 6. Token和认证状态测试

#### 6.1 Token存储
1. 登录成功后
2. 打开浏览器开发者工具 → Application → Local Storage
3. 验证：token字段存在且值为JWT格式

#### 6.2 Token使用
1. 登录后访问需要认证的页面（如书架、历史记录）
2. 验证：请求头Authorization包含Bearer token

#### 6.3 Token过期处理
1. 等待JWT过期（真实后端24小时，mock不过期）
2. 尝试访问需要认证的接口
3. 预期：自动跳转到登录页面（前端Axios拦截器处理）

#### 6.4 登出功能
1. 点击用户头像 → 退出登录
2. 预期：清除localStorage中的token，跳转到登录页

---

### 7. 权限控制测试

#### 7.1 普通用户权限
1. 使用普通用户账号登录
2. 预期：不能访问管理员功能（如用户管理、小说管理）

#### 7.2 管理员权限
1. 使用管理员账号登录
2. 预期：可以访问管理员功能和后台管理页面

#### 7.3 401未授权处理
1. 清除token或使用过期的token
2. 访问需要认证的页面
3. 预期：自动跳转到登录页，并显示"请先登录"提示

---

### 8. 用户体验测试

#### 8.1 响应式设计
- [x] 在移动端（375px）、平板（768px）、桌面（1024px+）上测试
- [x] 所有页面布局合理，表单可用

#### 8.2 Loading状态
- [x] 登录、注册、重置密码时显示加载状态
- [x] 发送验证码按钮显示倒计时和禁用状态

#### 8.3 错误提示
- [x] 错误消息清晰易懂
- [x] 消息显示位置正确（右上角或表单上方）
- [x] 消息自动消失（success）或需要手动关闭（error）

#### 8.4 页面跳转
- [x] 登录、注册、重置密码之间的导航正常
- [x] 重置密码后跳转回登录页
- [x] 认证后访问登录页自动跳转到首页

---

## 测试数据

### Mock模式使用示例

```typescript
// 注册测试账号
const testUser = {
  username: 'testuser',
  displayName: '测试用户',
  email: 'test@example.com',
  password: 'test123',
  code: '123456'  // Mock模式固定验证码
};

// 登录测试
const loginData = {
  credential: 'testuser',  // 或 'test@example.com'
  password: 'test123'
};

// 重置密码
const resetData = {
  email: 'test@example.com',
  code: '123456',  // Mock模式固定验证码
  password: 'newpassword123',
  confirmPassword: 'newpassword123'
};
```

---

## 测试检查清单

在Mock模式下完成以下测试：

### 注册与登录
- [x] 注册新账号
- [x] 使用账号名登录
- [x] 使用邮箱登录
- [x] 管理员账号登录

### 密码重置
- [x] 发送重置邮件
- [x] 使用验证码重置密码
- [x] 使用新密码登录

### 错误处理
- [x] 账号不存在提示
- [x] 密码错误提示
- [x] 验证码错误提示
- [x] 表单验证提示

### 状态管理
- [x] Token存储正确
- [x] 用户信息存储正确
- [x] 登出功能正常
- [x] 401处理正确

### 用户体验
- [x] 响应式设计正常
- [x] Loading状态显示
- [x] 消息提示清晰
- [x] 页面跳转正确

---

## 问题记录

| 问题描述 | 严重程度 | 状态 | 解决方案 |
|---------|---------|------|---------|
| | | | |

---

## 真实后端测试补充

当使用真实后端时，需要额外测试：

### 数据库验证
1. 注册后检查数据库中用户记录
2. 验证密码加密存储（bcrypt）
3. 验证邮箱唯一性约束

### 邮件发送
1. 验证验证码邮件发送
2. 检查邮件格式和内容
3. 测试验证码过期机制

### JWT认证
1. 验证JWT生成正确
2. 验证Token过期时间（24小时）
3. 测试Token刷新机制（如实现）

### 安全性测试
1. 测试SQL注入防护
2. 测试XSS防护
3. 测试密码强度要求
4. 测试登录尝试限制（如实现）

---

## 性能测试

- [x] 登录API响应时间 < 1s
- [x] 注册API响应时间 < 2s
- [x] 密码重置API响应时间 < 2s
- [x] 前端页面加载时间 < 3s
- [x] 无内存泄漏

---

**测试执行人：**
**测试日期：**
**测试结果：** ☐ 通过 ☐ 失败
**备注：**
